function geoFindMe(){function n(n){latitude=n.coords.latitude;longitude=n.coords.longitude}function t(){alert("Unable to retrieve your location")}var i=document.getElementById("out");if(!navigator.geolocation){alert("Geolocation is not supported by your browser!");return}navigator.geolocation.getCurrentPosition(n,t)}var HaberimdesinApp=angular.module("Haberimdesin",[]),habersOfUser=null,habers=null,lastNew=null,last2News=null,updatedLikes=!1,haberLikes=null,commentLikes=null,haberDislikes=null,commentDislikes=null,activeUserID=null,haberToEdit=null,longitude=0,latitude=0;HaberimdesinApp.controller("News",["$scope","$http",function(n,t){geoFindMe();n.distance=100;n.activeHaber=null;n.getUserID=function(){return console.log(activeUserID),activeUserID};n.last2News=function(){return last2News};n.lastNew=function(){return lastNew};n.haberToEdit=function(){return haberToEdit};n.habersOfUser=function(){return habersOfUser};n.updateDistanceLimit=function(t){n.distance=t};n.getHaberLikesOf=function(n){return haberLikes.has(n)?haberLikes.get(n).length:0};n.getHaberDislikesOf=function(n){return haberDislikes.has(n)?haberDislikes.get(n).length:0};n.getCommentDislikesOf=function(n){return commentDislikes.has(n)?commentDislikes.get(n).length:0};n.getCommentLikesOf=function(n){return commentLikes.has(n)?commentLikes.get(n).length:0};t.get("/haberimdesin/getCategories").success(function(t){n.categories=t.categories}).error(function(n){console.log(n)});n.updateUserID=function(){t.get("/haberimdesin/getUserID").success(function(t){activeUserID=t.usID;n.updateHabersOfUser()}).error(function(n){console.log(n)})};n.getAllNews=function(){t.get("/haberimdesin/getAllNews").success(function(t){habers=t.newsList.reverse();lastNew=habers[0];last2News=habers.slice(1,3);n.activeHaber=null}).error(function(n){console.log(n)})};n.updateHaberLikes=function(){if(!updatedLikes){updatedLikes=!0;haberLikes=new Map;haberDislikes=new Map;commentLikes=new Map;commentDislikes=new Map;var n="/haberimdesin/getAllHaberLikes";t.get(n).success(function(n){var t,r;for(i=0;i<n.haberLikeList.length;i++)t=n.haberLikeList[i].haberID,haberLikes.has(t)===!1&&haberLikes.set(t,[]),r=haberLikes.get(t),r.push(n.haberLikeList[i].userID),haberLikes.set(t,r)}).error(function(n){console.log(n)});n="/haberimdesin/getAllHaberDislikes";t.get(n).success(function(n){var t,r;for(i=0;i<n.haberDislikeList.length;i++)t=n.haberDislikeList[i].haberID,haberDislikes.has(t)===!1&&haberDislikes.set(t,[]),r=haberDislikes.get(t),r.push(n.haberDislikeList[i].userID),haberDislikes.set(t,r)}).error(function(n){console.log(n)});n="/haberimdesin/getAllCommentLikes";t.get(n).success(function(n){var t,r;for(i=0;i<n.commentLikeList.length;i++)t=n.commentLikeList[i].commentID,commentLikes.has(t)===!1&&commentLikes.set(t,[]),r=commentLikes.get(t),r.push(n.commentLikeList[i].userID),commentLikes.set(t,r)}).error(function(n){console.log(n)});n="/haberimdesin/getAllCommentDislikes";t.get(n).success(function(n){var t,r;for(i=0;i<n.commentDislikeList.length;i++)t=n.commentDislikeList[i].commentID,commentDislikes.has(t)===!1&&commentDislikes.set(t,[]),r=commentDislikes.get(t),r.push(n.commentDislikeList[i].userID),commentDislikes.set(t,r)}).error(function(n){console.log(n)})}};n.getAllNews();n.updateHaberLikes();n.updateUserID();n.habers=function(){var t;if(habers!==null){for(t=habers.slice(0),i=t.length-1;i>=0;i--){var u=t[i].latitude,f=t[i].longitude,e=longitude-f,r=Math.sin(latitude*(Math.PI/180))*Math.sin(u*(Math.PI/180))+Math.cos(latitude*(Math.PI/180))*Math.cos(u*(Math.PI/180))*Math.cos(e*(Math.PI/180));r=Math.acos(r);r=r*(180/Math.PI);r=r*60*1.1515;r>n.distance&&(console.log(t[i].title),t.splice(i,1))}return t}};n.updateHabersOfUser=function(){var n="/haberimdesin/getNewsByUserID/"+activeUserID;t.get(n).success(function(n){habersOfUser=n.newsList.reverse();console.log(habersOfUser)}).error(function(n){console.log(n)})};n.getNewsByCategory=function(i){var r="/haberimdesin/getNewsByID/"+i;t.get(r).success(function(t){last2News=null;lastNew=null;habers=t.newsList.reverse();n.activeHaber=null}).error(function(n){console.log(n)})};n.changeCategory=function(n){console.log(n);haberToEdit.categoryID=n};n.updateHaber=function(){var n=new FormData;console.log(haberToEdit);n.append("id",haberToEdit.haberID);n.append("title",haberToEdit.title);n.append("detail",haberToEdit.detail);n.append("headline",haberToEdit.headLine);n.append("categoryID",haberToEdit.categoryID);t.post("/Haberimdesin/UpdateHaber",n,{transformRequest:angular.identity,headers:{"Content-Type":undefined}}).success(function(){haberToEdit=null}).error(function(n){console.log(n)})};n.likeComment=function(i){for(var u,r=0;commentLikes.has(i)&&r<commentLikes.get(i).length;r++)if(commentLikes.get(i)[r]===activeUserID){n.cancelLikeComment(i);return}for(r=0;commentDislikes.has(i)&&r<commentDislikes.get(i).length;r++)commentDislikes.get(i)[r]===activeUserID&&n.cancelDislikeComment(i);u=new FormData;u.append("id",i);t.post("/Haberimdesin/LikeComment",u,{transformRequest:angular.identity,headers:{"Content-Type":undefined}}).success(function(){commentLikes.has(i)===!1&&commentLikes.set(i,[]);var n=commentLikes.get(i);n.push(activeUserID);commentLikes.set(i,n)}).error(function(n){console.log(n)})};n.dislikeComment=function(r){for(i=0;commentLikes.has(r)&&i<commentLikes.get(r).length;i++)commentLikes.get(r)[i]===activeUserID&&n.cancelLikeComment(r);for(i=0;commentDislikes.has(r)&&i<commentDislikes.get(r).length;i++)if(commentDislikes.get(r)[i]===activeUserID){n.cancelDislikeComment(r);return}var u=new FormData;u.append("id",r);t.post("/Haberimdesin/DislikeComment",u,{transformRequest:angular.identity,headers:{"Content-Type":undefined}}).success(function(){commentDislikes.has(r)===!1&&commentDislikes.set(r,[]);var n=commentDislikes.get(r);n.push(activeUserID);commentDislikes.set(r,n)}).error(function(n){console.log(n)})};n.cancelLikeComment=function(n){var i=new FormData;i.append("id",n);t.post("/Haberimdesin/CancelLikeComment",i,{transformRequest:angular.identity,headers:{"Content-Type":undefined}}).success(function(){if(commentLikes.has(n)===!0){var t=commentLikes.get(n);t.pop(activeUserID);commentLikes.set(n,t)}}).error(function(n){console.log(n)})};n.cancelDislikeComment=function(n){var i=new FormData;i.append("id",n);t.post("/Haberimdesin/CancelDislikeComment",i,{transformRequest:angular.identity,headers:{"Content-Type":undefined}}).success(function(){if(commentDislikes.has(n)===!0){var t=commentDislikes.get(n);t.pop(activeUserID);commentDislikes.set(n,t)}}).error(function(n){console.log(n)})};n.cancelDislikeNews=function(){var i=n.activeHaber[0].haberID,r=new FormData;r.append("id",n.activeHaber[0].haberID);t.post("/Haberimdesin/CancelDislikeNews",r,{transformRequest:angular.identity,headers:{"Content-Type":undefined}}).success(function(){if(haberDislikes.has(i)===!0){var n=haberDislikes.get(i);n.pop(activeUserID);haberDislikes.set(i,n)}}).error(function(n){console.log(n)})};n.cancelLikeNews=function(){var i=n.activeHaber[0].haberID,r=new FormData;r.append("id",n.activeHaber[0].haberID);t.post("/Haberimdesin/CancelLikeNews",r,{transformRequest:angular.identity,headers:{"Content-Type":undefined}}).success(function(){if(haberLikes.has(i)===!0){var n=haberLikes.get(i);n.pop(activeUserID);haberLikes.set(i,n)}}).error(function(n){console.log(n)})};n.editNews=function(n){haberToEdit=n};n.cancelNews=function(i){var r=new FormData;r.append("id",i);t.post("/Haberimdesin/CancelHaberById",r,{transformRequest:angular.identity,headers:{"Content-Type":undefined}}).success(function(){haberToEdit=null;n.updateHabersOfUser()}).error(function(n){console.log(n)})};n.likeNews=function(){var r=n.activeHaber[0].haberID,u;for(i=0;haberLikes.has(r)&&i<haberLikes.get(r).length;i++)if(haberLikes.get(r)[i]===activeUserID){n.cancelLikeNews();return}for(i=0;haberDislikes.has(r)&&i<haberDislikes.get(r).length;i++)haberDislikes.get(r)[i]===activeUserID&&n.cancelDislikeNews();u=new FormData;u.append("id",n.activeHaber[0].haberID);t.post("/Haberimdesin/LikeNews",u,{transformRequest:angular.identity,headers:{"Content-Type":undefined}}).success(function(){haberLikes.has(r)===!1&&haberLikes.set(r,[]);var n=haberLikes.get(r);n.push(activeUserID);haberLikes.set(r,n)}).error(function(n){console.log(n)})};t.get("/haberimdesin/getCategories").success(function(t){n.data={model:null,availableOptions:t.categories}}).error(function(n){console.log(n)});n.dislikeNews=function(){var r=n.activeHaber[0].haberID,u;for(i=0;haberLikes.has(r)&&i<haberLikes.get(r).length;i++)haberLikes.get(r)[i]===activeUserID&&n.cancelLikeNews();for(i=0;haberDislikes.has(r)&&i<haberDislikes.get(r).length;i++)if(haberDislikes.get(r)[i]===activeUserID){n.cancelDislikeNews();return}u=new FormData;u.append("id",n.activeHaber[0].haberID);t.post("/Haberimdesin/DislikeNews",u,{transformRequest:angular.identity,headers:{"Content-Type":undefined}}).success(function(){haberDislikes.has(r)===!1&&haberDislikes.set(r,[]);var n=haberDislikes.get(r);n.push(activeUserID);haberDislikes.set(r,n)}).error(function(n){console.log(n)})};n.getNewsDetail=function(i){window.scrollTo(0,0);var r="/haberimdesin/getNewsDetail/"+i;t.get(r).success(function(t){habers=null;n.yorumlar=t.yorumList.reverse();n.lastNew=null;n.last2News=null;n.kisiler=t.userNameList.reverse();n.activeHaber=t.newsList}).error(function(n){console.log(n)})};n.uploadComment=function(){var r=new FormData,i,u;r.append("yorumIcerik",n.$$childTail.yorumIcerik);r.append("haberID",n.activeHaber[0].haberID);t.post("/Haberimdesin/CreateComment",r,{transformRequest:angular.identity,headers:{"Content-Type":undefined}}).success(function(n){console.log(n)}).error(function(n){console.log(n)});i=jQuery.extend({},n.yorumlar[0]);i.content=n.$$childTail.yorumIcerik;i.like=0;i.dislike=0;i.timeStamp=new Date;i.commentID=i.commentID+1;n.yorumlar.splice(0,0,i);u=n.activeHaber[0].user.name+" "+n.activeHaber[0].user.surname;n.kisiler.splice(0,0,u)};n.uploadUserProfileImage=function(){var i=new FormData,r=n.profileImageFiles;console.log(r);i.append("file",r);t.post("/Manage/uploadProfileImage",i,{transformRequest:angular.identity,headers:{"Content-Type":undefined}}).success(function(n){console.log(n);window.location.assign("/Manage/Index")}).error(function(n){console.log(n)})}}]);HaberimdesinApp.controller("addNewsController",["$scope","$http","$q",function(n,t){n.haberHeader="";n.haberHeadline="";n.haberDetail="";n.imageFiles=[];n.date=new Date;t.get("/haberimdesin/getCategories").success(function(t){n.data={model:null,availableOptions:t.categories}}).error(function(n){console.log(n)});geoFindMe();n.uploadNews=function(){var r=n.imageFiles,i=new FormData;for(var u in r)i.append("file[]",r[u]);i.append("haberHeader",n.haberHeader);i.append("haberHeadline",n.haberHeadline);i.append("haberDetail",n.haberDetail);i.append("latitude",latitude);i.append("longitude",longitude);i.append("CategoryID",n.data.model);t.post("/Haberimdesin/CreateNews",i,{transformRequest:angular.identity,headers:{"Content-Type":undefined}}).success(function(n){console.log(n+"oldu");window.location.assign("/Home/Index")}).error(function(n){console.log(n)})},function(n){console.log(n)}}]);HaberimdesinApp.directive("fileModel",["$parse",function(n){return{restrict:"A",link:function(t,i,r){var f=n(r.fileModel),u=f.assign,e=r.multiple;i.bind("change",function(){t.$apply(function(){if(e){var n=i[0].files;u(t,n)}else u(t,i[0].files[0])})})}}}]);