var HaberimdesinApp=angular.module("Haberimdesin",[]),habers=null,lastNew=null,last2News=null,updatedLikes=!1,haberLikes=null,commentLikes=null,haberDislikes=null,commentDislikes=null,activeUserID=null;HaberimdesinApp.controller("News",["$scope","$http",function(n,t){n.activeHaber=null;n.getUserID=function(){return activeUserID};n.last2News=function(){return last2News};n.lastNew=function(){return lastNew};n.habers=function(){return habers};n.getHaberLikesOf=function(n){return haberLikes.has(n)?haberLikes.get(n).length:0};n.getHaberDislikesOf=function(n){return haberDislikes.has(n)?haberDislikes.get(n).length:0};n.getCommentDislikesOf=function(n){return commentDislikes.has(n)?commentDislikes.get(n).length:0};n.getCommentLikesOf=function(n){return commentLikes.has(n)?commentLikes.get(n).length:0};t.get("/haberimdesin/getCategories").success(function(t){n.categories=t.categories}).error(function(n){console.log(n)});n.updateUserID=function(){t.get("/haberimdesin/getUserID").success(function(n){activeUserID=n.usID}).error(function(n){console.log(n)})};n.getAllNews=function(){t.get("/haberimdesin/getAllNews").success(function(t){habers=t.newsList.reverse();lastNew=habers[0];last2News=habers.slice(1,3);n.activeHaber=null}).error(function(n){console.log(n)})};n.updateHaberLikes=function(){if(!updatedLikes){updatedLikes=!0;haberLikes=new Map;haberDislikes=new Map;commentLikes=new Map;commentDislikes=new Map;var n="/haberimdesin/getAllHaberLikes";t.get(n).success(function(n){var t,r;for(i=0;i<n.haberLikeList.length;i++)t=n.haberLikeList[i].haberID,haberLikes.has(t)===!1&&haberLikes.set(t,[]),r=haberLikes.get(t),r.push(n.haberLikeList[i].userID),haberLikes.set(t,r)}).error(function(n){console.log(n)});n="/haberimdesin/getAllHaberDislikes";t.get(n).success(function(n){var t,r;for(i=0;i<n.haberDislikeList.length;i++)t=n.haberDislikeList[i].haberID,haberDislikes.has(t)===!1&&haberDislikes.set(t,[]),r=haberDislikes.get(t),r.push(n.haberDislikeList[i].userID),haberDislikes.set(t,r)}).error(function(n){console.log(n)});n="/haberimdesin/getAllCommentLikes";t.get(n).success(function(n){var t,r;for(i=0;i<n.commentLikeList.length;i++)t=n.commentLikeList[i].commentID,commentLikes.has(t)===!1&&commentLikes.set(t,[]),r=commentLikes.get(t),r.push(n.commentLikeList[i].userID),commentLikes.set(t,r)}).error(function(n){console.log(n)});n="/haberimdesin/getAllCommentDislikes";t.get(n).success(function(n){var t,r;for(i=0;i<n.commentDislikeList.length;i++)t=n.commentDislikeList[i].commentID,commentDislikes.has(t)===!1&&commentDislikes.set(t,[]),r=commentDislikes.get(t),r.push(n.commentDislikeList[i].userID),commentDislikes.set(t,r)}).error(function(n){console.log(n)})}};n.getAllNews();n.updateHaberLikes();n.updateUserID();n.getNewsByCategory=function(i){var r="/haberimdesin/getNewsByID/"+i;t.get(r).success(function(t){last2News=null;lastNew=null;habers=t.newsList.reverse();n.activeHaber=null}).error(function(n){console.log(n)})};n.likeComment=function(n){for(i=0;commentLikes.has(n)&&i<commentLikes.get(n).length;i++)if(commentLikes.get(n)[i]===activeUserID)return;for(i=0;commentDislikes.has(n)&&i<commentDislikes.get(n).length;i++)if(commentDislikes.get(n)[i]===activeUserID)return;var r=new FormData;r.append("id",n);t.post("/Haberimdesin/LikeComment",r,{transformRequest:angular.identity,headers:{"Content-Type":undefined}}).success(function(){commentLikes.has(n)===!1&&commentLikes.set(n,[]);var t=commentLikes.get(n);t.push(activeUserID);commentLikes.set(n,t)}).error(function(n){console.log(n)})};n.dislikeComment=function(n){for(i=0;commentLikes.has(n)&&i<commentLikes.get(n).length;i++)if(commentLikes.get(n)[i]===activeUserID)return;for(i=0;commentDislikes.has(n)&&i<commentDislikes.get(n).length;i++)if(commentDislikes.get(n)[i]===activeUserID)return;var r=new FormData;r.append("id",n);t.post("/Haberimdesin/DislikeComment",r,{transformRequest:angular.identity,headers:{"Content-Type":undefined}}).success(function(){commentDislikes.has(n)===!1&&commentDislikes.set(n,[]);var t=commentDislikes.get(n);t.push(activeUserID);commentDislikes.set(n,t)}).error(function(n){console.log(n)})};n.likeNews=function(){var r=n.activeHaber[0].haberID,u;for(i=0;haberLikes.has(r)&&i<haberLikes.get(r).length;i++)if(haberLikes.get(r)[i]===activeUserID)return;for(i=0;haberDislikes.has(r)&&i<haberDislikes.get(r).length;i++)if(haberDislikes.get(r)[i]===activeUserID)return;u=new FormData;u.append("id",n.activeHaber[0].haberID);t.post("/Haberimdesin/LikeNews",u,{transformRequest:angular.identity,headers:{"Content-Type":undefined}}).success(function(){haberLikes.has(r)===!1&&haberLikes.set(r,[]);var n=haberLikes.get(r);n.push(activeUserID);haberLikes.set(r,n)}).error(function(n){console.log(n)})};n.dislikeNews=function(){var r=n.activeHaber[0].haberID,u;for(i=0;haberLikes.has(r)&&i<haberLikes.get(r).length;i++)if(haberLikes.get(r)[i]===activeUserID)return;for(i=0;haberDislikes.has(r)&&i<haberDislikes.get(r).length;i++)if(haberDislikes.get(r)[i]===activeUserID)return;u=new FormData;u.append("id",n.activeHaber[0].haberID);t.post("/Haberimdesin/DislikeNews",u,{transformRequest:angular.identity,headers:{"Content-Type":undefined}}).success(function(){haberDislikes.has(r)===!1&&haberDislikes.set(r,[]);var n=haberDislikes.get(r);n.push(activeUserID);haberDislikes.set(r,n)}).error(function(n){console.log(n)})};n.getNewsDetail=function(i){window.scrollTo(0,0);var r="/haberimdesin/getNewsDetail/"+i;t.get(r).success(function(t){habers=null;n.yorumlar=t.yorumList.reverse();n.lastNew=null;n.last2News=null;n.kisiler=t.userNameList.reverse();n.activeHaber=t.newsList}).error(function(n){console.log(n)})};n.uploadComment=function(){var r=new FormData,i,u;r.append("yorumIcerik",n.$$childTail.yorumIcerik);r.append("haberID",n.activeHaber[0].haberID);t.post("/Haberimdesin/CreateComment",r,{transformRequest:angular.identity,headers:{"Content-Type":undefined}}).success(function(n){console.log(n)}).error(function(n){console.log(n)});i=jQuery.extend({},n.yorumlar[0]);i.content=n.$$childTail.yorumIcerik;i.like=0;i.dislike=0;i.timeStamp=new Date;i.commentID=i.commentID+1;n.yorumlar.splice(0,0,i);u=n.activeHaber[0].user.name+" "+n.activeHaber[0].user.surname;n.kisiler.splice(0,0,u)}}]);HaberimdesinApp.controller("addNewsController",["$scope","$http","$q",function(n,t,i){function r(){return i(function(n,t){if(navigator.geolocation)navigator.geolocation.watchPosition(function(t){return lat=t.coords.latitude,longi=t.coords.longitude,n({lat:lat,longi:longi})},function(n){switch(n.code){case n.PERMISSION_DENIED:return t({error:"User denied the request for Geolocation."});case n.POSITION_UNAVAILABLE:return t({error:"Location information is unavailable."});case n.TIMEOUT:return t({error:"The request to get user location timed out."});case n.UNKNOWN_ERROR:return t({error:"An unknown error occurred."})}});else return t({error:"Browser Not Support"})})}n.haberHeader="";n.haberHeadline="";n.haberDetail="";n.imageFiles=[];n.date=new Date;t.get("/haberimdesin/getCategories").success(function(t){n.data={model:null,availableOptions:t.categories}}).error(function(n){console.log(n)});n.uploadNews=function(){r().then(function(i){var u=n.imageFiles,r=new FormData;for(var f in u)r.append("file[]",u[f]);r.append("haberHeader",n.haberHeader);r.append("haberHeadline",n.haberHeadline);r.append("haberDetail",n.haberDetail);r.append("latitude",i.lat);r.append("longitude",i.longi);r.append("CategoryID",n.data.model);t.post("/Haberimdesin/CreateNews",r,{transformRequest:angular.identity,headers:{"Content-Type":undefined}}).success(function(n){console.log(n+"oldu");window.location.assign("/Home/Index")}).error(function(n){console.log(n)})},function(){console.log(res)})}}]);HaberimdesinApp.directive("fileModel",["$parse",function(n){return{restrict:"A",link:function(t,i,r){var f=n(r.fileModel),u=f.assign,e=r.multiple;i.bind("change",function(){t.$apply(function(){if(e){var n=i[0].files;u(t,n)}else u(t,i[0].files[0])})})}}}]);